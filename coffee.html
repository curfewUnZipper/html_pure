<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Preferences</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body {
            background-color: #f7f3e9;
            color: #3e2723;
        }

        .navbar {
            background-color: #6f4e37;
        }

        .navbar-brand {
            color: #f7f3e9 !important;
            cursor: pointer;
        }

        .form-container {
            max-width: 600px;
            margin: 50px auto;
            background: #fff;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        #usernameDisplay {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .landing-page {
            display: none;
            text-align: center;
            margin-top: 50px;
        }
        .d-grid {
            display: grid;
            place-items: center;
         }

        .btn-get-started {
            background-color: #6f4e37;
            color: white;
            border: none;
            width: auto;
            padding: 10px 20px;
            font-size: 1.1rem;
            width: 10rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn-get-started:hover {
            background-color: #4b3621;
            color: white;
        }

        .btn-signout {
            background-color: #d32f2f;
            color: white;
            border: none;
            padding: 5px 10px;
            font-size: 1rem;
            cursor: pointer;
        }

        .btn-signout:hover {
            background-color: #c62828;
        }

        .navbar-brand:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" id="homeButton" onclick="goHome()">Coffee Fanatics</a>
            <button class="btn btn-signout" id="signOutButton" style="display: none;" onclick="signOut()">Sign Out</button>
        </div>
    </nav>

    <div class="container">
        <!-- Landing Page -->
        <div class="landing-page" id="landingPage">
            <h2>Welcome to Coffee Fanatics</h2>
            <p>Store your coffee preferences for a fast checkout.</p>
            <div class="d-grid gap-2">
                <button class="btn-get-started" onclick="showAuthForm()">Get Started</button>
            </div>
        </div>

        <!-- Authentication Form -->
        <div class="form-container" id="authForm" style="display: none;">
            <h2 class="text-center">User Sign Up / Sign In</h2>
            <form id="authFormContent">
                <div class="mb-3">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" class="form-control" id="username" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-primary" onclick="signup()">Sign Up</button>
                    <button type="button" class="btn btn-secondary" onclick="signin()">Sign In</button>
                </div>
            </form>
        </div>

        <!-- Coffee Preferences Form -->
        <div class="form-container" id="preferencesForm" style="display: none;">
            <div id="usernameDisplay"></div>
            <h2 class="text-center">Coffee Preferences</h2>
            <form>
                <div class="mb-3">
                    <label for="brewStrength" class="form-label">Brew Strength</label>
                    <select class="form-select" id="brewStrength">
                        <option value="light">Light</option>
                        <option value="medium">Medium</option>
                        <option value="strong">Strong</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="temperature" class="form-label">Temperature (Â°C)</label>
                    <input type="number" class="form-control" id="temperature">
                </div>

                <div class="mb-3">
                    <label for="flavorProfile" class="form-label">Flavor Profile</label>
                    <input type="text" class="form-control" id="flavorProfile">
                </div>

                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-success" onclick="savePreferences()">Save Preferences</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let activeUser = null;

        function getUsers() {
            return JSON.parse(localStorage.getItem('users')) || [];
        }

        function saveUsers(users) {
            localStorage.setItem('users', JSON.stringify(users));
        }

        function signup() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const users = getUsers();

            if (users.some(user => user.username === username)) {
                alert('Username already exists. Please sign in.');
                return;
            }

            users.push({ username, password, preferences: {} });
            saveUsers(users);

            alert('Sign up successful! You can now set your preferences.');
            clearAuthFields();
            showPreferencesForm(username);
        }

        function signin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const users = getUsers();

            const user = users.find(user => user.username === username && user.password === password);

            if (user) {
                alert('Sign in successful!');
                clearAuthFields();
                showPreferencesForm(username);

                // Load preferences if available
                document.getElementById('brewStrength').value = user.preferences.brewStrength || 'medium';
                document.getElementById('temperature').value = user.preferences.temperature || '';
                document.getElementById('flavorProfile').value = user.preferences.flavorProfile || '';
            } else {
                alert('Invalid credentials. Please try again.');
            }
        }

        function savePreferences() {
            const brewStrength = document.getElementById('brewStrength').value;
            const temperature = document.getElementById('temperature').value;
            const flavorProfile = document.getElementById('flavorProfile').value;

            const users = getUsers();
            const userIndex = users.findIndex(user => user.username === activeUser);

            if (userIndex !== -1) {
                users[userIndex].preferences = { brewStrength, temperature, flavorProfile };
                saveUsers(users);
                alert('Preferences saved!');
            } else {
                alert('User not found. Please sign in again.');
            }
        }

        function signOut() {
            activeUser = null;
            alert('Signed out successfully!');
            
            // Redirect to the authentication form (sign-in/up page)
            document.getElementById('authForm').style.display = 'block';
            document.getElementById('preferencesForm').style.display = 'none';
            document.getElementById('signOutButton').style.display = 'none';
            document.getElementById('landingPage').style.display = 'none';
            
            // Reset form fields
            document.getElementById('authForm').reset();
            document.getElementById('preferencesForm').reset();
            document.getElementById('usernameDisplay').textContent = '';
            
            // Show the landing page if needed
            document.getElementById('landingPage').style.display = 'block';
        }

        function clearAuthFields() {
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function showPreferencesForm(username) {
            activeUser = username;
            document.getElementById('authForm').style.display = 'none';
            document.getElementById('preferencesForm').style.display = 'block';
            document.getElementById('signOutButton').style.display = 'inline-block';
            document.getElementById('usernameDisplay').textContent = `Welcome, ${username}`;
        }

        function showAuthForm() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('authForm').style.display = 'block';
        }

        function goHome() {
            document.getElementById('landingPage').style.display = 'block';
            document.getElementById('authForm').style.display = 'none';
            document.getElementById('preferencesForm').style.display = 'none';
            document.getElementById('signOutButton').style.display = 'none';
        }

        // Check if user is already logged in
        window.onload = function () {
            const users = getUsers();
            const storedUser = users.find(user => user.username === activeUser);

            if (storedUser) {
                showPreferencesForm(storedUser.username);

                // Load preferences if available
                document.getElementById('brewStrength').value = storedUser.preferences.brewStrength || 'medium';
                document.getElementById('temperature').value = storedUser.preferences.temperature || '';
                document.getElementById('flavorProfile').value = storedUser.preferences.flavorProfile || '';
            } else {
                document.getElementById('landingPage').style.display = 'block';
            }
        };
    </script>
</body>

</html>
